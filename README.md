# Genetic Yield Optimization: A Simulation Study

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

This repository contains a suite of Python scripts for simulating and analyzing strategies for genetic intervention in a crop/livlivestock population. The core of the project is to model the trade-offs in selective breeding and explore the relationship between genetic makeup and overall yield, particularly in the context of inbreeding depression or other genetic-diversity-related costs.

For a detailed breakdown of the computational methods and algorithms, please see the **[Simulation Strategy and Numerical Methods](docs/Algorithms.md)** document, which serves as an online appendix.

The project compares three regulatory models:
1.  **The Myopic Regulator:** A decision-maker who optimizes breeding strategies to maximize the expected yield of the *very next generation*, without considering long-term consequences.
2.  **The Forward-Looking Regulator:** A rational agent who uses dynamic programming to find an optimal policy that maximizes the total discounted stream of future yields over an infinite horizon.
3.  **The Robust Regulation Strategy:** A pragmatic regulator who commits to a single, constant policy over a fixed number of generations, aiming to maximize the average yield across that entire period.

## Documentation
Formal algorithms (myopic engine and VFI), grids, tolerances, and convergence criteria are described in **docs/Algorithms.md**.

## Project Structure

This project is currently organized as a collection of core modules and several runnable analysis scripts. Each script performs a specific task or comparison.

#### Core Modules (Libraries)

*   `module_simulation.py`: Contains the fundamental logic for the genetic model, including population initialization, genotype calculation, yield functions, and the core simulation engine for comparative statics.
*   `module_plot.py`: A utility module containing functions for generating various plots from simulation results, such as 2D benefit curves, 3D yield surfaces, and dynamic evolution trajectories.

#### Runnable Analysis Scripts

*   `main.py`: A flexible command-line tool for performing **comparative statics analysis**. It simulates how the optimal breeding strategy and potential benefits change as a single model parameter is varied.
*   `myopic_model_suite.py`: A comprehensive analysis suite for the **Myopic Regulator model**. It can calculate the optimal policy function `a*(p)`, simulate the dynamic evolution of the gene pool and policy over generations, and generate plots to explain how the optimal policy is determined.
*   `dp_simulation.py`: An implementation of the **Forward-Looking (Dynamic Programming) model**. It uses value function iteration to solve for the optimal policy and simulates the long-term trajectory of the population under this policy.
*   `compare_policies.py`: A script specifically designed to **compare the policy functions** generated by the Myopic model and the Forward-Looking model on a single plot.
*   `myopic_policy_function.py`: A focused script that calculates and plots only the optimal policy function `a*(p)` for the Myopic Regulator.

## Getting Started

To run these simulations, you will need Python 3 and the libraries listed in `requirements.txt`.

### Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/fengchaoya/inbreeding-depression-simulation.git
    cd inbreeding-depression-simulation
    ```

2.  **Create and activate a virtual environment:**
    ```bash
    python -m venv venv
    # On Windows
    venv\Scripts\activate
    # On macOS/Linux
    source venv/bin/activate
    ```

3.  **Install the required packages:**
    The required packages are listed below. You can install them all using the provided `requirements.txt` file.
    ```bash
    pip install -r requirements.txt
    ```

    <details>
    <summary>Content of requirements.txt</summary>

    ```
    contourpy==1.3.2
    cycler==0.12.1
    fonttools==4.58.2
    kiwisolver==1.4.8
    matplotlib==3.10.3
    numpy==2.3.0
    packaging==25.0
    pillow==11.2.1
    pyparsing==3.2.3
    python-dateutil==2.9.0.post0
    scipy==1.16.2
    six==1.17.0
    ```
    </details>

## How to Run

Each of the primary `.py` files can be run independently from the terminal to perform a different analysis. All generated plots and results will be saved in corresponding `results`, `myopic_results`, or `comparison_results` folders.

### 1. Comparative Statics Analysis (`main.py`)

This is the most flexible script. It operates in two modes: `simulate` and `plot`.

*   **To run a new simulation:**
    You must specify which parameter you want to analyze.
    ```bash
    # Example: Analyze the effect of the dominance coefficient 'h'
    python main.py simulate h
    ```
    This will run the simulation and save the results in a `.npy` file inside the `results/` directory (e.g., `results_h_20251101-143000.npy`).

*   **To plot results from a saved simulation file:**
    ```bash
    python main.py plot results/results_h_20251101-143000.npy
    ```
    This will generate and display multiple plots based on the data in the specified file.

### 2. Myopic Model Deep Dive (`myopic_model_suite.py`)

This script runs a full suite of analyses for the myopic model. You can control which analyses to run by editing the boolean flags at the top of the `if __name__ == '__main__':` block within the script.

*   **To run the script:**
    ```bash
    python myopic_model_suite.py
    ```
    By default, it will calculate the policy function, run dynamic simulations for several initial conditions, and generate explanatory plots, saving them to the `myopic_results/` folder.

### 3. Dynamic Programming Solution (`dp_simulation.py`)

This script solves the forward-looking model and visualizes the results.

*   **To run the script:**
    ```bash
    python dp_simulation.py
    ```
    It will perform value function iteration until convergence and then display a 4-panel figure showing the value function, the optimal policy, and the dynamic evolution of `p` and `a`.

### 4. Policy Comparison (`compare_policies.py`)

This script directly compares the final policy functions from the myopic and dynamic models.

*   **To run the script:**
    ```bash
    python compare_policies.py
    ```
    It will compute both policies and generate a single comparative plot named `policy_comparison.png` in the `comparison_results/` folder.

## Future Work

The current structure consists of several independent scripts, which is ideal for research and exploration. A planned next step is to refactor this project into a more cohesive and unified application. This will involve:
*   Creating a single command-line interface (CLI) that can trigger all different types of analyses.
*   Consolidating redundant code and standardizing parameter management.
*   Improving the project structure for better maintainability and scalability.

## License

This project is licensed under the MIT License - see the `LICENSE` file for details.